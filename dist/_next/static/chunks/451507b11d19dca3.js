(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},37880,68834,e=>{"use strict";let t,r;e.i(47167);var s=e.i(71645);let a=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e))},l=t=e(s,a,i);return i},i=e=>{let t=e?a(e):a,r=e=>(function(e,t=e=>e){let r=s.default.useSyncExternalStore(e.subscribe,s.default.useCallback(()=>t(e.getState()),[e,t]),s.default.useCallback(()=>t(e.getInitialState()),[e,t]));return s.default.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},l=e=>e?i(e):i;e.s(["create",()=>l],68834);let n=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>n(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>n(t)(e)}}};var o=e.i(17927);let d=l()((t=(e,t)=>({user:null,isLoading:!1,error:null,setUser:t=>e({user:t}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),login:async(t,r)=>{e({isLoading:!0,error:null});let s=(0,o.createClient)();try{let a=t;if(!t.includes("@")){let{data:e,error:r}=await s.from("users").select("email").eq("username",t).single();if(r||!e)throw Error("Invalid username or password");a=e.email}let{data:i,error:l}=await s.auth.signInWithPassword({email:a,password:r});if(l)throw l;if(!i.user?.email_confirmed_at)throw Error("Please verify your email before logging in");let{data:n,error:o}=await s.from("users").select("*").eq("id",i.user.id).single();if(o)throw o;e({user:n,isLoading:!1})}catch(t){throw e({error:t.message,isLoading:!1}),t}},signup:async(t,r,s)=>{e({isLoading:!0,error:null});let a=(0,o.createClient)();try{let{data:i}=await a.from("users").select("email").eq("email",t).single();if(i)throw Error("Email already registered");let{data:l}=await a.from("users").select("username").eq("username",r).single();if(l)throw Error("Username already taken");let{data:n,error:o}=await a.auth.signUp({email:t,password:s,options:{data:{username:r},emailRedirectTo:"https://kutxchat.vercel.app/login"}});if(o)throw o;if(n.user){let{error:e}=await a.from("users").insert({id:n.user.id,email:t,username:r,password_hash:""});if(e)throw e}e({isLoading:!1})}catch(t){throw e({error:t.message,isLoading:!1}),t}},logout:async()=>{e({isLoading:!0,error:null});let r=(0,o.createClient)();try{let s=t().user;s&&await r.from("users").update({status:"offline",last_seen:new Date().toISOString()}).eq("id",s.id),await r.auth.signOut(),e({user:null,isLoading:!1})}catch(t){throw e({error:t.message,isLoading:!1}),t}},resetPassword:async t=>{e({isLoading:!0,error:null});let r=(0,o.createClient)();try{let{error:s}=await r.auth.resetPasswordForEmail(t,{redirectTo:"https://kutxchat.vercel.app/reset-password"});if(s)throw s;e({isLoading:!1})}catch(t){throw e({error:t.message,isLoading:!1}),t}},updatePassword:async t=>{e({isLoading:!0,error:null});let r=(0,o.createClient)();try{let{error:s}=await r.auth.updateUser({password:t});if(s)throw s;e({isLoading:!1})}catch(t){throw e({error:t.message,isLoading:!1}),t}}}),r={name:"auth-storage"},(e,s,a)=>{let i,l={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let s=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(s):s(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>window.localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...r},o=!1,d=0,u=new Set,c=new Set,m=l.storage;if(!m)return t((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),e(...t)},s,a);let h=()=>{let e=l.partialize({...s()});return m.setItem(l.name,{state:e,version:l.version})},f=a.setState;a.setState=(e,t)=>(f(e,t),h());let g=t((...t)=>(e(...t),h()),s,a);a.getInitialState=()=>g;let w=()=>{var t,r;if(!m)return;let a=++d;o=!1,u.forEach(e=>{var t;return e(null!=(t=s())?t:g)});let f=(null==(r=l.onRehydrateStorage)?void 0:r.call(l,null!=(t=s())?t:g))||void 0;return n(m.getItem.bind(m))(l.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];else{if(l.migrate){let t=l.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(t=>{var r;if(a!==d)return;let[n,o]=t;if(e(i=l.merge(o,null!=(r=s())?r:g),!0),n)return h()}).then(()=>{a===d&&(null==f||f(i,void 0),i=s(),o=!0,c.forEach(e=>e(i)))}).catch(e=>{a===d&&(null==f||f(void 0,e))})};return a.persist={setOptions:e=>{l={...l,...e},e.storage&&(m=e.storage)},clearStorage:()=>{null==m||m.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>w(),hasHydrated:()=>o,onHydrate:e=>(u.add(e),()=>{u.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},l.skipHydration||w(),i||g}));e.s(["useAuthStore",0,d],37880)},1206,e=>{"use strict";var t=e.i(43476),r=e.i(47163);let s=(0,e.i(71645).forwardRef)(({className:e,error:s,...a},i)=>(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("input",{ref:i,className:(0,r.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s&&"border-red-500 focus-visible:ring-red-500",e),...a}),s&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-500",children:s})]}));s.displayName="Input",e.s(["Input",()=>s])},80176,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(76525),a=e.i(1206),i=e.i(37880),l=e.i(18566);function n(){let[e,n]=(0,r.useState)(""),[o,d]=(0,r.useState)(""),[u,c]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),{updatePassword:f,isLoading:g,error:w,setError:p}=(0,i.useAuthStore)(),x=(0,l.useRouter)(),b=(0,l.useSearchParams)();(0,r.useEffect)(()=>{"recovery"!==b.get("type")&&x.push("/login")},[b,x]);let v=async t=>{if(t.preventDefault(),p(null),c(""),e.length<6)return void c("Password must be at least 6 characters long");if(e!==o)return void c("Passwords do not match");try{await f(e),h(!0)}catch(e){}};return m?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Password Updated"}),(0,t.jsx)("p",{className:"text-slate-500 mb-6",children:"Your password has been successfully reset."}),(0,t.jsx)(s.Button,{onClick:()=>x.push("/login"),className:"w-full",children:"Go to Login"})]})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Reset Password"}),(0,t.jsx)("p",{className:"text-slate-500 mt-2",children:"Enter your new password"})]}),(0,t.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"New Password"}),(0,t.jsx)(a.Input,{type:"password",value:e,onChange:e=>n(e.target.value),placeholder:"Enter new password",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Confirm Password"}),(0,t.jsx)(a.Input,{type:"password",value:o,onChange:e=>d(e.target.value),placeholder:"Confirm new password",required:!0})]}),(u||w)&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:u||w})}),(0,t.jsx)(s.Button,{type:"submit",className:"w-full",isLoading:g,children:"Reset Password"})]})]})})}function o(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"})}),children:(0,t.jsx)(n,{})})}e.s(["default",()=>o])}]);